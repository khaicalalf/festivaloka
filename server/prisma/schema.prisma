generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. Tabel Customer (Menyimpan Poin, Email, HP)
model Customer {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  phone     String
  points    Int      @default(0) // Poin loyalitas
  orders    Order[]  // Customer bisa punya banyak order
  createdAt DateTime @default(now())
}

// 2. Tabel Tenant (Daftar Toko di Festival)
model Tenant {
  id          Int      @id @default(autoincrement())
  name        String   // Nama Toko (misal: Seblak Viral)
  category    String   // Makanan / Minuman
  description String?  // Deskripsi buat dibaca AI
  isViral     Boolean  @default(false)
  status      String   @default("OPEN") // OPEN / CLOSED / BUSY
  menus       Menu[]
  orders      Order[]
  queues      Queue[]
}

// 3. Tabel Menu (Daftar Makanan per Toko)
model Menu {
  id          Int     @id @default(autoincrement())
  name        String
  price       Int
  description String?
  tenantId    Int
  tenant      Tenant  @relation(fields: [tenantId], references: [id])
}

// 4. Tabel Order (Transaksi Pembelian)
model Order {
  id          String   @id @default(uuid())
  totalAmount Int
  status      String   @default("PENDING")
  queueNumber String?
  items       Json?

  // RELASI BALIK (Tanpa 'fields' & 'references')
  queue       Queue?   

  // ... (sisa field tenantId, customerId dll tetap sama) ...
  tenantId    Int
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  customerId  Int?
  customer    Customer? @relation(fields: [customerId], references: [id])
  createdAt   DateTime @default(now())
}

// 5. Tabel Queue (Antrian untuk setiap toko)
model Queue {
  id        Int      @id @default(autoincrement())
  number    String
  status    String   @default("WAITING")

  // FOREIGN KEY DIDEFINISIKAN DI SINI
  orderId   String?  @unique // @unique wajib untuk relasi 1-to-1
  order     Order?   @relation(fields: [orderId], references: [id]) 

  // ... (sisa field tenantId dll tetap sama) ...
  tenantId  Int
  tenant    Tenant   @relation(fields: [tenantId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}